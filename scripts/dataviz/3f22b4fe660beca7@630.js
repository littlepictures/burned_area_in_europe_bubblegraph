function _1(md){return(
md`# Force Directed Bubble Chart`
)}

function _data(){return(
[{'country': 'Albania',
  'color': '#451137',
  'values': {'2001': 115,
   '2002': 22,
   '2003': 306,
   '2004': 46,
   '2005': 155,
   '2006': 57,
   '2007': 1627,
   '2008': 308,
   '2009': 145,
   '2010': 171,
   '2011': 649,
   '2012': 812,
   '2013': 39,
   '2014': 30,
   '2015': 112,
   '2016': 76,
   '2017': 560,
   '2018': 73,
   '2019': 112,
   '2020': 138}},
 {'country': 'Austria',
  'color': '#7f2a30',
  'values': {'2001': 16,
   '2002': 9,
   '2003': 14,
   '2004': 21,
   '2005': 38,
   '2006': 37,
   '2007': 6,
   '2008': 10,
   '2009': 0,
   '2010': 1,
   '2011': 75,
   '2012': 3,
   '2013': 2,
   '2014': 5,
   '2015': 5,
   '2016': 3,
   '2017': 2,
   '2018': 5,
   '2019': 4,
   '2020': 0}},
 {'country': 'Belgium',
  'color': '#b93e1b',
  'values': {'2001': 0,
   '2002': 0,
   '2003': 7,
   '2004': 0,
   '2005': 0,
   '2006': 1,
   '2007': 4,
   '2008': 2,
   '2009': 0,
   '2010': 0,
   '2011': 13,
   '2012': 0,
   '2013': 0,
   '2014': 0,
   '2015': 0,
   '2016': 0,
   '2017': 1,
   '2018': 9,
   '2019': 2,
   '2020': 0}},
 {'country': 'Bulgaria',
  'color': '#e2772c',
  'values': {'2001': 7602,
   '2002': 980,
   '2003': 2511,
   '2004': 4951,
   '2005': 2299,
   '2006': 4037,
   '2007': 2360,
   '2008': 2694,
   '2009': 1544,
   '2010': 1076,
   '2011': 2655,
   '2012': 2947,
   '2013': 1886,
   '2014': 1432,
   '2015': 1950,
   '2016': 2623,
   '2017': 2709,
   '2018': 1255,
   '2019': 1902,
   '2020': 572}},
 {'country': 'Bosnia and Herzegovina',
  'color': '#f0af4f',
  'values': {'2001': 135,
   '2002': 33,
   '2003': 1103,
   '2004': 47,
   '2005': 58,
   '2006': 53,
   '2007': 538,
   '2008': 136,
   '2009': 163,
   '2010': 49,
   '2011': 302,
   '2012': 1143,
   '2013': 35,
   '2014': 26,
   '2015': 124,
   '2016': 181,
   '2017': 663,
   '2018': 33,
   '2019': 139,
   '2020': 363}},
 {'country': 'Switzerland',
  'color': '#fbfcb8',
  'values': {'2001': 0,
   '2002': 0,
   '2003': 5,
   '2004': 0,
   '2005': 0,
   '2006': 0,
   '2007': 2,
   '2008': 0,
   '2009': 0,
   '2010': 0,
   '2011': 0,
   '2012': 4,
   '2013': 0,
   '2014': 0,
   '2015': 0,
   '2016': 0,
   '2017': 0,
   '2018': 1,
   '2019': 0,
   '2020': 0}},
 {'country': 'Czech Republic',
  'color': '#451132',
  'values': {'2001': 6,
   '2002': 27,
   '2003': 8,
   '2004': 18,
   '2005': 36,
   '2006': 15,
   '2007': 2,
   '2008': 6,
   '2009': 7,
   '2010': 2,
   '2011': 23,
   '2012': 10,
   '2013': 13,
   '2014': 34,
   '2015': 19,
   '2016': 8,
   '2017': 9,
   '2018': 16,
   '2019': 3,
   '2020': 3}},
 {'country': 'Germany',
  'color': '#7f2a23',
  'values': {'2001': 0,
   '2002': 2,
   '2003': 18,
   '2004': 4,
   '2005': 0,
   '2006': 4,
   '2007': 1,
   '2008': 12,
   '2009': 2,
   '2010': 6,
   '2011': 27,
   '2012': 0,
   '2013': 3,
   '2014': 2,
   '2015': 6,
   '2016': 1,
   '2017': 2,
   '2018': 31,
   '2019': 65,
   '2020': 0}},
 {'country': 'Denmark',
  'color': '#b93e1a',
  'values': {'2001': 0,
   '2002': 0,
   '2003': 6,
   '2004': 6,
   '2005': 2,
   '2006': 5,
   '2007': 2,
   '2008': 1,
   '2009': 0,
   '2010': 0,
   '2011': 0,
   '2012': 0,
   '2013': 0,
   '2014': 6,
   '2015': 0,
   '2016': 0,
   '2017': 0,
   '2018': 0,
   '2019': 0,
   '2020': 0}},
 {'country': 'Spain',
  'color': '#e27742',
  'values': {'2001': 1367,
   '2002': 1610,
   '2003': 2677,
   '2004': 2653,
   '2005': 1785,
   '2006': 1552,
   '2007': 639,
   '2008': 295,
   '2009': 1011,
   '2010': 402,
   '2011': 1179,
   '2012': 1927,
   '2013': 982,
   '2014': 407,
   '2015': 880,
   '2016': 945,
   '2017': 2139,
   '2018': 319,
   '2019': 730,
   '2020': 647}},
 {'country': 'Estonia',
  'color': '#f0af71',
  'values': {'2001': 1,
   '2002': 64,
   '2003': 33,
   '2004': 15,
   '2005': 0,
   '2006': 46,
   '2007': 2,
   '2008': 13,
   '2009': 8,
   '2010': 2,
   '2011': 0,
   '2012': 1,
   '2013': 2,
   '2014': 9,
   '2015': 6,
   '2016': 7,
   '2017': 0,
   '2018': 6,
   '2019': 3,
   '2020': 3}},
 {'country': 'Finland',
  'color': '#fbfcae',
  'values': {'2001': 9,
   '2002': 12,
   '2003': 27,
   '2004': 20,
   '2005': 9,
   '2006': 42,
   '2007': 3,
   '2008': 44,
   '2009': 7,
   '2010': 18,
   '2011': 15,
   '2012': 1,
   '2013': 6,
   '2014': 6,
   '2015': 6,
   '2016': 6,
   '2017': 5,
   '2018': 45,
   '2019': 11,
   '2020': 7}},
 {'country': 'France',
  'color': '#451124',
  'values': {'2001': 235,
   '2002': 249,
   '2003': 726,
   '2004': 132,
   '2005': 223,
   '2006': 30,
   '2007': 116,
   '2008': 39,
   '2009': 161,
   '2010': 33,
   '2011': 51,
   '2012': 119,
   '2013': 3,
   '2014': 97,
   '2015': 35,
   '2016': 238,
   '2017': 286,
   '2018': 22,
   '2019': 213,
   '2020': 75}},
 {'country': 'United Kingdom',
  'color': '#7f2a35',
  'values': {'2001': 57,
   '2002': 60,
   '2003': 458,
   '2004': 36,
   '2005': 24,
   '2006': 35,
   '2007': 227,
   '2008': 79,
   '2009': 147,
   '2010': 101,
   '2011': 161,
   '2012': 96,
   '2013': 29,
   '2014': 11,
   '2015': 44,
   '2016': 104,
   '2017': 79,
   '2018': 114,
   '2019': 119,
   '2020': 125}},
 {'country': 'Greece',
  'color': '#b93e22',
  'values': {'2001': 1217,
   '2002': 426,
   '2003': 458,
   '2004': 761,
   '2005': 371,
   '2006': 389,
   '2007': 3141,
   '2008': 979,
   '2009': 748,
   '2010': 208,
   '2011': 1355,
   '2012': 959,
   '2013': 531,
   '2014': 989,
   '2015': 432,
   '2016': 709,
   '2017': 500,
   '2018': 235,
   '2019': 442,
   '2020': 220}},
 {'country': 'Croatia',
  'color': '#e27724',
  'values': {'2001': 487,
   '2002': 118,
   '2003': 635,
   '2004': 164,
   '2005': 186,
   '2006': 158,
   '2007': 580,
   '2008': 490,
   '2009': 378,
   '2010': 93,
   '2011': 471,
   '2012': 760,
   '2013': 80,
   '2014': 48,
   '2015': 118,
   '2016': 131,
   '2017': 782,
   '2018': 30,
   '2019': 117,
   '2020': 166}},
 {'country': 'Hungary',
  'color': '#f0af6f',
  'values': {'2001': 1122,
   '2002': 223,
   '2003': 1076,
   '2004': 654,
   '2005': 530,
   '2006': 384,
   '2007': 327,
   '2008': 748,
   '2009': 521,
   '2010': 58,
   '2011': 416,
   '2012': 528,
   '2013': 135,
   '2014': 166,
   '2015': 155,
   '2016': 50,
   '2017': 65,
   '2018': 102,
   '2019': 79,
   '2020': 21}},
 {'country': 'Ireland',
  'color': '#fbfcb7',
  'values': {'2001': 4,
   '2002': 5,
   '2003': 23,
   '2004': 0,
   '2005': 0,
   '2006': 6,
   '2007': 58,
   '2008': 7,
   '2009': 4,
   '2010': 50,
   '2011': 17,
   '2012': 8,
   '2013': 28,
   '2014': 4,
   '2015': 68,
   '2016': 3,
   '2017': 68,
   '2018': 7,
   '2019': 0,
   '2020': 15}},
 {'country': 'Iceland',
  'color': '#451127',
  'values': {'2001': 0,
   '2002': 0,
   '2003': 0,
   '2004': 0,
   '2005': 0,
   '2006': 71,
   '2007': 2,
   '2008': 0,
   '2009': 0,
   '2010': 5,
   '2011': 0,
   '2012': 1,
   '2013': 0,
   '2014': 0,
   '2015': 0,
   '2016': 0,
   '2017': 0,
   '2018': 0,
   '2019': 0,
   '2020': 0}},
 {'country': 'Italy',
  'color': '#7f2a20',
  'values': {'2001': 2413,
   '2002': 946,
   '2003': 2755,
   '2004': 2905,
   '2005': 1127,
   '2006': 1309,
   '2007': 4300,
   '2008': 3105,
   '2009': 1503,
   '2010': 2252,
   '2011': 2277,
   '2012': 3015,
   '2013': 1669,
   '2014': 1527,
   '2015': 1104,
   '2016': 1623,
   '2017': 2270,
   '2018': 719,
   '2019': 2007,
   '2020': 1193}},
 {'country': 'Kosovo',
  'color': '#b93e05',
  'values': {'2001': 40,
   '2002': 6,
   '2003': 58,
   '2004': 75,
   '2005': 82,
   '2006': 25,
   '2007': 414,
   '2008': 83,
   '2009': 125,
   '2010': 81,
   '2011': 451,
   '2012': 252,
   '2013': 149,
   '2014': 115,
   '2015': 111,
   '2016': 15,
   '2017': 86,
   '2018': 29,
   '2019': 83,
   '2020': 63}},
 {'country': 'Lithuania',
  'color': '#e27713',
  'values': {'2001': 16,
   '2002': 201,
   '2003': 291,
   '2004': 82,
   '2005': 29,
   '2006': 155,
   '2007': 58,
   '2008': 21,
   '2009': 136,
   '2010': 17,
   '2011': 47,
   '2012': 19,
   '2013': 33,
   '2014': 82,
   '2015': 80,
   '2016': 35,
   '2017': 19,
   '2018': 14,
   '2019': 71,
   '2020': 12}},
 {'country': 'Luxembourg',
  'color': '#f0af44',
  'values': {'2001': 0,
   '2002': 0,
   '2003': 0,
   '2004': 0,
   '2005': 0,
   '2006': 0,
   '2007': 0,
   '2008': 0,
   '2009': 0,
   '2010': 0,
   '2011': 0,
   '2012': 0,
   '2013': 0,
   '2014': 0,
   '2015': 0,
   '2016': 0,
   '2017': 0,
   '2018': 0,
   '2019': 0,
   '2020': 0}},
 {'country': 'Latvia',
  'color': '#fbfcaa',
  'values': {'2001': 50,
   '2002': 156,
   '2003': 159,
   '2004': 32,
   '2005': 1,
   '2006': 118,
   '2007': 2,
   '2008': 0,
   '2009': 34,
   '2010': 0,
   '2011': 15,
   '2012': 3,
   '2013': 1,
   '2014': 10,
   '2015': 14,
   '2016': 7,
   '2017': 1,
   '2018': 31,
   '2019': 5,
   '2020': 10}},
 {'country': 'Moldova',
  'color': '#45110e',
  'values': {'2001': 1352,
   '2002': 343,
   '2003': 41,
   '2004': 532,
   '2005': 681,
   '2006': 596,
   '2007': 657,
   '2008': 2156,
   '2009': 759,
   '2010': 471,
   '2011': 899,
   '2012': 285,
   '2013': 494,
   '2014': 1549,
   '2015': 807,
   '2016': 1008,
   '2017': 664,
   '2018': 211,
   '2019': 301,
   '2020': 86}},
 {'country': 'Macedonia',
  'color': '#7f2a31',
  'values': {'2001': 112,
   '2002': 61,
   '2003': 82,
   '2004': 104,
   '2005': 85,
   '2006': 149,
   '2007': 641,
   '2008': 223,
   '2009': 79,
   '2010': 120,
   '2011': 384,
   '2012': 310,
   '2013': 161,
   '2014': 26,
   '2015': 112,
   '2016': 76,
   '2017': 341,
   '2018': 18,
   '2019': 333,
   '2020': 26}},
 {'country': 'Montenegro',
  'color': '#b93e0d',
  'values': {'2001': 62,
   '2002': 0,
   '2003': 115,
   '2004': 1,
   '2005': 4,
   '2006': 58,
   '2007': 591,
   '2008': 83,
   '2009': 28,
   '2010': 52,
   '2011': 267,
   '2012': 689,
   '2013': 26,
   '2014': 0,
   '2015': 216,
   '2016': 32,
   '2017': 490,
   '2018': 46,
   '2019': 60,
   '2020': 129}},
 {'country': 'Netherlands',
  'color': '#e27737',
  'values': {'2001': 0,
   '2002': 2,
   '2003': 8,
   '2004': 0,
   '2005': 0,
   '2006': 9,
   '2007': 0,
   '2008': 0,
   '2009': 2,
   '2010': 2,
   '2011': 0,
   '2012': 1,
   '2013': 2,
   '2014': 5,
   '2015': 0,
   '2016': 0,
   '2017': 2,
   '2018': 3,
   '2019': 0,
   '2020': 0}},
 {'country': 'Norway',
  'color': '#f0af62',
  'values': {'2001': 11,
   '2002': 4,
   '2003': 90,
   '2004': 13,
   '2005': 38,
   '2006': 24,
   '2007': 6,
   '2008': 56,
   '2009': 2,
   '2010': 41,
   '2011': 3,
   '2012': 14,
   '2013': 2,
   '2014': 25,
   '2015': 6,
   '2016': 1,
   '2017': 17,
   '2018': 2,
   '2019': 38,
   '2020': 13}},
 {'country': 'Poland',
  'color': '#fbfcc0',
  'values': {'2001': 133,
   '2002': 310,
   '2003': 564,
   '2004': 79,
   '2005': 90,
   '2006': 51,
   '2007': 36,
   '2008': 24,
   '2009': 51,
   '2010': 32,
   '2011': 22,
   '2012': 59,
   '2013': 19,
   '2014': 80,
   '2015': 118,
   '2016': 33,
   '2017': 2,
   '2018': 40,
   '2019': 25,
   '2020': 65}},
 {'country': 'Portugal',
  'color': '#451107',
  'values': {'2001': 991,
   '2002': 1260,
   '2003': 4767,
   '2004': 1434,
   '2005': 3958,
   '2006': 844,
   '2007': 356,
   '2008': 137,
   '2009': 991,
   '2010': 1647,
   '2011': 832,
   '2012': 1013,
   '2013': 1936,
   '2014': 175,
   '2015': 548,
   '2016': 1899,
   '2017': 5664,
   '2018': 413,
   '2019': 459,
   '2020': 605}},
 {'country': 'Romania',
  'color': '#7f2a1f',
  'values': {'2001': 6610,
   '2002': 793,
   '2003': 1229,
   '2004': 4240,
   '2005': 3163,
   '2006': 3284,
   '2007': 2447,
   '2008': 7371,
   '2009': 3896,
   '2010': 4493,
   '2011': 6420,
   '2012': 6117,
   '2013': 3151,
   '2014': 3384,
   '2015': 2903,
   '2016': 4147,
   '2017': 3434,
   '2018': 1524,
   '2019': 2971,
   '2020': 1896}},
 {'country': 'Republic of Serbia',
  'color': '#b93e40',
  'values': {'2001': 714,
   '2002': 320,
   '2003': 1544,
   '2004': 1059,
   '2005': 694,
   '2006': 838,
   '2007': 1448,
   '2008': 1776,
   '2009': 2381,
   '2010': 539,
   '2011': 3946,
   '2012': 2842,
   '2013': 1311,
   '2014': 182,
   '2015': 695,
   '2016': 780,
   '2017': 1410,
   '2018': 1376,
   '2019': 1712,
   '2020': 150}},
 {'country': 'Slovakia',
  'color': '#e27737',
  'values': {'2001': 18,
   '2002': 51,
   '2003': 69,
   '2004': 135,
   '2005': 88,
   '2006': 44,
   '2007': 56,
   '2008': 40,
   '2009': 11,
   '2010': 27,
   '2011': 40,
   '2012': 38,
   '2013': 14,
   '2014': 30,
   '2015': 29,
   '2016': 7,
   '2017': 2,
   '2018': 14,
   '2019': 21,
   '2020': 4}},
 {'country': 'Slovenia',
  'color': '#f0af57',
  'values': {'2001': 0,
   '2002': 0,
   '2003': 2,
   '2004': 1,
   '2005': 4,
   '2006': 0,
   '2007': 0,
   '2008': 0,
   '2009': 0,
   '2010': 0,
   '2011': 0,
   '2012': 0,
   '2013': 0,
   '2014': 0,
   '2015': 0,
   '2016': 0,
   '2017': 8,
   '2018': 0,
   '2019': 0,
   '2020': 2}},
 {'country': 'Sweden',
  'color': '#fbfcc6',
  'values': {'2001': 0,
   '2002': 87,
   '2003': 20,
   '2004': 5,
   '2005': 37,
   '2006': 70,
   '2007': 9,
   '2008': 26,
   '2009': 7,
   '2010': 1,
   '2011': 9,
   '2012': 8,
   '2013': 41,
   '2014': 124,
   '2015': 18,
   '2016': 0,
   '2017': 8,
   '2018': 230,
   '2019': 10,
   '2020': 8}}]
)}

function _width(){return(
1080
)}

function _height(){return(
1080
)}

function _node_data(data,width,height){return(
data.map(d => ({
  ...d,
  r: d.values["2005"] / 30 ,  // Adjusted scale factor to balance attraction
  x: Math.random() * width,
  y: Math.random() * height
}))
)}

function _force(d3,node_data,width,height){return(
d3.forceSimulation(node_data)
  .force("x", d3.forceX(width / 2).strength(0.1))
  .force("y", d3.forceY(height / 2).strength(0.1))
  .force("charge", d3.forceManyBody().strength(25))
  .force("collide", d3.forceCollide().radius(d => d.r + 1.5).strength(2))
)}

function _chart(d3,width,height,node_data,force)
{
  const svg = d3.create("svg")
    .attr("viewBox", [0, 0, width, height])
    .style("background", "#2f0c03");

  const node = svg.append("g")
    .selectAll("circle")
    .data(node_data)
    .join("circle")
      .attr("r", d => d.r)
      .attr("fill", d => d.color)
      .attr("stroke", "#fff")
      .attr("stroke-width", 0);

  // Sort the data by radius and select the top 5
  const top5 = node_data.slice().sort((a, b) => d3.descending(a.r, b.r)).slice(0, 5);

  // Add labels only for the top 5 countries of the respective year. Remove this section for clean graphics.
  const labels = svg.append("g")
    .selectAll("text")
    .data(top5)
    .join("text")
    .text(d => d.country)
    .attr("text-anchor", "middle")
    .attr("alignment-baseline", "middle")
    .style("fill", "#fff")
    .style("font-family", "Helvetica")
    .style("font-weight", "bold");

  force.on("tick", () => {
    node
      .attr("cx", d => d.x)
      .attr("cy", d => d.y);

  labels
     .attr("x", d => d.x)
     .attr("y", d => d.y);
  });

  return svg.node();
}


export default function define(runtime, observer) {
  const main = runtime.module();
  main.variable(observer()).define(["md"], _1);
  main.variable(observer("data")).define("data", _data);
  main.variable(observer("width")).define("width", _width);
  main.variable(observer("height")).define("height", _height);
  main.variable(observer("node_data")).define("node_data", ["data","width","height"], _node_data);
  main.variable(observer("force")).define("force", ["d3","node_data","width","height"], _force);
  main.variable(observer("chart")).define("chart", ["d3","width","height","node_data","force"], _chart);
  return main;
}
